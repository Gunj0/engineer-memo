# 構造に関するパターン

## Facade: 建物の正面, 窓口

- 基本
  - クライアント側からサブシステムへの窓口となる統一インターフェースを定義する
- 詳細
  - static の ProjectFacade クラスを定義する(Service 等)
    - Interface を噛ませてクライアントからこれを参照すれば、Facade の入れ替えも容易になる
  - 各サブシステムを new して返すメソッドを定義する
  - 各サブシステムは基本的に internal にして、Facade, Entity, Dto だけを public にする
- メリット
  - クライアント側からどの処理を使えばいいか分かりやすくなる
    - 不要なアクセスをさせないようにできる
    - サブシステムの使い方のメモ・説明書にもなる
  - 使う際の知識を集約できる, 一連の手順を吸収できる

## Adapter: 規格の変換

- 基本
  - 変更できない・したくないオブジェクトの規格を、求めるインターフェースに変換する
- 詳細
  - Object Adapter パターン: コンポジション(has-a)【推奨】
    - ターゲットインターフェースを実装した Adapter クラスの中で Adaptee をインスタンス化して返す
  - Class Adapter パターン: 継承(is-a)
    - ターゲットインターフェースを実装して Adaptee を継承した状態で機能を返す
    - 二重継承の場合は使用できない。GoF 本でも非推奨。
- メリット
  - 元のファイル・クライアント側を変更せずに規格を統一して使用できる
    - 元のファイルのテストをする必要がなくなる

## Composite: 階層構造

- 基本
  - 親と子を同一視して階層構造を実装する
  - 容器と中身を同一視して再帰的な構造の扱いを統一にする
- 詳細
  - `Execute` メソッドを持つ部品クラスを Interface/抽象クラスで定義する
  - 部品クラスを実装/継承する `Folder` クラス と `File` クラスを定義する
  - Folder クラスには部品クラスの `List` をもたせ、`Add` メソッドで `List` に部品を追加できるようにする
  - リスコフの置換原則に従い、部品クラスと`File` クラスにも `Add` メソッドをもたせ、例外を投げるようにする
  - `GetChildren`メソッド等を `Folder` クラスに作り`List` を返すようにしておくことでクライアント側で再帰的な処理ができる
  - `Folder` クラス と `File` クラス以外にも、バリエーションを作ることもできる
- メリット
  - 親と子を同一視するのでクライアント側が簡潔になる
  - 階層が増えても変更が楽になる

## Decorator: 機能拡張ラッパー

- 基本
  - 継承よりも柔軟に、既存クラスを変更せずに機能を拡張する
- 詳細
  - `IComponent`を実装した、機能拡張したい`ComponentA`があるとする
  - 同じ`IComponent`を実装した`DecoratorUpper`を定義する
    - この中で`IComponent`クラスの`_child`変数に、拡張したい`ComponentA`を受け取る
    - `_child`のメソッドを呼び出し、拡張したい機能を追記する
  - Decorator が複数ある場合は`DecoratorUpper`は`Decorator`抽象クラスを作って継承させる
    - `Decorator`抽象クラスでは共通処理を書き、子クラスは固有処理のみを書く
- メリット
  - 継承やフラグ管理などと違い、コンポーネントの数 × 拡張機能で複雑にクラスが増えたりしない
  - コンポーネントごとの拡張機能を共通化することができる

## Bridge: クラスの組み合わせの橋渡し

- 基本
  - 抽出されたクラスと実装を分離して、それらを独立に変更できるようにする
- 詳細
  - 「拡張の単位」と「実装の単位」を分け、それぞれを抽象化・インターフェース化して継承・実装させる
    - 「拡張の単位」の例: AcDevice, BatteryDevice, SunDevice (Device 抽象クラス)
    - 「実装の単位」の例: TempMeasure, WindMeasure (IMeasure インターフェース)
    - 分けたあと、拡張側に実装側を依存性注入するようにする
    - クライアント側では、拡張側を呼び、引数に実装側を入れることで組み合わせを表現できる
- メリット
  - 組み合わせ爆発が起きない

## Flyweight

- 基本
- 詳細
- メリット

## Proxy

- 基本
- 詳細
- メリット

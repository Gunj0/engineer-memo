# ドメイン駆動開発: DDD

## ドメイン駆動とは

- オブジェクト指向とデザインパターンの最適化手法
- どこにどんなクラスを配置するか？を考えて複雑さを取り除く
- 基本的にはテスト駆動開発をする

## 3 層構造

- UI
  - Domain と Infrastructure を参照する
  - 画面
    - View
    - ViewModel: 画面と 1 対 1 のロジック
- Infrastructure
  - Domain を参照する
  - アプリケーションの外側との接触部分
    - データ取得 等
- Domain
  - どこも参照しない, 最上位
  - ビジネスロジック
    - ValueObject:
    - Entity: DB 接続
    - Helper: 共通処理
    - Exception: 例外
    - 静的ロジック: インスタンス化しない共通処理
    - Interface: Repository パターン

## デザインパターン

### Repository パターン

- I~Repository を実装する
- DB 接続はモック化することでテストしやすくなる

### Entity

- プロパティとロジックがセットになったオブジェクト
- テーブルの 1 レコードに相当する
- できれば完全コンストラクタパターンにする
  - = 初期化時にしか値がセットできない

### ValueObject

- 値として扱うクラス
  - 別インスタンスでも値が同じなら同じものとして扱う
- 絶対に完全コンストラクタパターンにする
  - = 初期化時にしか値がセットできない
- 値とロジックは一体化させる
  - 知識はデータに持たせて使う側に持たせない
  - = 集約
- ロジックがある DB 項目は基本的に ValueObject にしたほうがよい

## メリット

- Domain が他を参照しないため、UI や Infrastructure の変更に左右されない
